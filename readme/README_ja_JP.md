# WordPress REST API Plugin for Dify

**作成者:** r3-yamauchi  
**バージョン:** 0.0.1  
**タイプ:** tool

[English](https://github.com/r3-yamauchi/dify-wordpress-plugin/blob/main/README.md) | 日本語

> ⚠️ **注意: このプラグインは非公式です**  
> このプラグインはWordPressの提供元が開発・保守しているものではありません。コミュニティによって開発された非公式のプラグインです。ご利用は自己責任でお願いいたします。

## 概要

`wordpress` は、WordPressサイトのREST APIと直接連携するDify用ツール・プラグインです。WordPressの公式SDKを必要とせずに、投稿、ページ、メディアファイルの作成、読み取り、更新、削除が可能です。この実装では`requests`ライブラリを使用してWordPress REST APIを直接呼び出すため、制限のあるDify環境でも互換性があります。

このプラグインのソースコードは[GitHubリポジトリ](https://github.com/r3-yamauchi/dify-wordpress-plugin)で公開されています。

[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/r3-yamauchi/dify-wordpress-plugin)

## 特長

- **投稿管理**: WordPress投稿の完全なCRUD操作（取得、作成、更新、削除）。
- **ページ管理**: WordPressページの完全なCRUD操作（取得、作成、更新、削除）。
- **メディア管理**: WordPressメディアファイルの完全なCRUD操作（取得、アップロード、更新、削除）。
- **カテゴリー管理**: WordPressカテゴリーの完全なCRUD操作（取得、作成、更新、削除）。
- **タグ管理**: WordPressタグの完全なCRUD操作（取得、作成、更新、削除）。
- **コメント管理**: WordPressコメントの完全なCRUD操作（取得、作成、更新、削除）。
- **WordPress.com MCP機能**: WordPress.comのMCPサーバーが提供する機能に対応（サイト設定、統計、ユーザー、コメント、プラグインなど）。
- **認証**: WordPress Application Passwordsを使用した安全な認証。
- **直接REST API呼び出し**: 公式WordPress SDKへの依存なし。リトライロジックとレート制限ハンドリングを内蔵したHTTPクライアントを使用。
- **セキュリティ**: デバッグログを適切にサニタイズし、本番環境での機密情報漏洩を防止。
- **エラーハンドリング**: 一般的な問題に対する有用なヒントを含む包括的なエラーハンドリング。

## プロバイダー設定

1. Difyにプラグインをアップロード/パッケージ化します。
2. 認証情報を設定します：
   - `wordpress_url` *(必須)* – WordPressサイトのURL（例: https://example.com）。
   - `username` *(必須)* – 認証用のWordPressユーザー名。
   - `application_password` *(秘密、必須)* – WordPressユーザープロフィールから生成したアプリケーションパスワード。
3. ワークフローノードにツールを配置し、パラメータをマッピングします。

### アプリケーションパスワードの生成方法

1. WordPress管理画面にログインします。
2. ユーザー → プロフィールに移動します。
3. 「アプリケーションパスワード」セクションまでスクロールします。
4. アプリケーション名を入力します（例: "Dify Plugin"）。
5. 「新しいアプリケーションパスワードを追加」をクリックします。
6. 生成されたパスワードをコピーします（一度しか表示されません）。

## ツール

### `get_posts`
WordPressサイトから投稿を取得します（オプションでフィルタリング可能）。

- **入力**: 
  - `per_page` (オプション): 1ページあたりの投稿数（デフォルト: 10、最大: 100）
  - `page` (オプション): ページ番号（デフォルト: 1）
  - `search` (オプション): 投稿をフィルタリングする検索クエリ
  - `status` (オプション): ステータスでフィルタリング（publish, draft, pending, private, future, trash）
  - `categories` (オプション): カテゴリーIDでフィルタリング（単一のID、カンマ区切りのID、またはIDの配列）
  - `tags` (オプション): タグIDでフィルタリング（単一のID、カンマ区切りのID、またはIDの配列）
- **出力**: ID、タイトル、内容、ステータス、その他のメタデータを含む投稿の配列。

### `create_post`
WordPressに新しい投稿を作成します。

- **入力**:
  - `title` (必須): 投稿タイトル（最大255文字）
  - `content` (必須): HTML形式の投稿本文
  - `status` (オプション): 投稿ステータス（publish, draft, pending, private, future）。デフォルトはdraft。
  - `featured_media` (オプション): アイキャッチ画像として設定するメディア（画像）ID
  - `categories` (オプション): 投稿に割り当てるカテゴリーID。単一のID、カンマ区切りのID（例: "1,2,3"）、またはIDの配列を指定できます。`get_categories`ツールで取得したIDを使用できます。
  - `tags` (オプション): 投稿に割り当てるタグID。単一のID、カンマ区切りのID（例: "1,2,3"）、またはIDの配列を指定できます。`get_tags`ツールで取得したIDを使用できます。
- **出力**: ID、タイトル、リンク、ステータスを含む作成された投稿の情報。

### `update_post`
既存のWordPress投稿を更新します。

- **入力**:
  - `id` (必須): 更新する投稿ID
  - `title` (オプション): 新しい投稿タイトル
  - `content` (オプション): 新しい投稿本文
  - `status` (オプション): 新しい投稿ステータス
  - `featured_media` (オプション): 新しいアイキャッチ画像ID（0を指定すると削除）
  - `categories` (オプション): 投稿に割り当てるカテゴリーID。単一のID、カンマ区切りのID（例: "1,2,3"）、またはIDの配列を指定できます。`get_categories`ツールで取得したIDを使用できます。
  - `tags` (オプション): 投稿に割り当てるタグID。単一のID、カンマ区切りのID（例: "1,2,3"）、またはIDの配列を指定できます。`get_tags`ツールで取得したIDを使用できます。
- **出力**: 更新された投稿の情報。

### `delete_post`
WordPress投稿を削除します。

- **入力**:
  - `id` (必須): 削除する投稿ID
  - `force` (オプション): trueの場合、完全削除。false（デフォルト）の場合、ゴミ箱に移動。
- **出力**: 投稿IDと削除ステータスを含む削除結果。

### `get_pages`
WordPressサイトからページを取得します（オプションでフィルタリング可能）。

- **入力**: 
  - `per_page` (オプション): 1ページあたりのページ数（デフォルト: 10、最大: 100）
  - `page` (オプション): ページ番号（デフォルト: 1）
  - `search` (オプション): ページをフィルタリングする検索クエリ
  - `status` (オプション): ステータスでフィルタリング（publish, draft, pending, private, future, trash）
- **出力**: ID、タイトル、内容、ステータス、その他のメタデータを含むページの配列。

### `create_page`
WordPressに新しいページを作成します。

- **入力**:
  - `title` (必須): ページタイトル（最大255文字）
  - `content` (必須): HTML形式のページ本文
  - `status` (オプション): ページステータス（publish, draft, pending, private, future）。デフォルトはdraft。
  - `featured_media` (オプション): アイキャッチ画像として設定するメディア（画像）ID
  - `parent` (オプション): 子ページを作成するための親ページID
- **出力**: ID、タイトル、リンク、ステータスを含む作成されたページの情報。

### `update_page`
既存のWordPressページを更新します。

- **入力**:
  - `id` (必須): 更新するページID
  - `title` (オプション): 新しいページタイトル
  - `content` (オプション): 新しいページ本文
  - `status` (オプション): 新しいページステータス
  - `featured_media` (オプション): 新しいアイキャッチ画像ID（0を指定すると削除）
  - `parent` (オプション): 新しい親ページID（0を指定すると親子関係を削除）
- **出力**: 更新されたページの情報。

### `delete_page`
WordPressページを削除します。

- **入力**:
  - `id` (必須): 削除するページID
  - `force` (オプション): trueの場合、完全削除。false（デフォルト）の場合、ゴミ箱に移動。
- **出力**: ページIDと削除ステータスを含む削除結果。

### `get_media`
WordPressサイトからメディアファイルを取得します（オプションでフィルタリング可能）。

- **入力**: 
  - `per_page` (オプション): 1ページあたりのメディア数（デフォルト: 10、最大: 100）
  - `page` (オプション): ページ番号（デフォルト: 1）
  - `search` (オプション): メディアをフィルタリングする検索クエリ
  - `media_type` (オプション): タイプでフィルタリング（image, video, audio, applicationなど）
  - `mime_type` (オプション): MIMEタイプでフィルタリング（例: image/jpeg, image/png, video/mp4）
- **出力**: ID、タイトル、URL、MIMEタイプ、その他のメタデータを含むメディアの配列。

### `upload_media`
WordPressにメディアファイル（画像、動画、音声など）をアップロードします。

- **入力**:
  - `file` (必須): アップロードするメディアファイル
  - `title` (オプション): メディアのタイトル
  - `caption` (オプション): メディアのキャプション（メディアの下に表示されます）
  - `alt_text` (オプション): メディアの代替テキスト（アクセシビリティのために重要）
  - `description` (オプション): メディアの説明
- **出力**: ID、タイトル、URL、MIMEタイプを含むアップロードされたメディアの情報。

### `update_media`
既存のWordPressメディアファイルのメタデータを更新します。

- **入力**:
  - `id` (必須): 更新するメディアID
  - `title` (オプション): 新しいメディアのタイトル
  - `caption` (オプション): 新しいメディアのキャプション
  - `alt_text` (オプション): 新しいメディアの代替テキスト
  - `description` (オプション): 新しいメディアの説明
- **出力**: 更新されたメディアの情報。

### `delete_media`
WordPressメディアファイルを削除します。

- **入力**:
  - `id` (必須): 削除するメディアID
  - `force` (オプション): trueの場合、完全削除。false（デフォルト）の場合、ゴミ箱に移動。
- **出力**: メディアIDと削除ステータスを含む削除結果。

### `get_post_details`
WordPressサイトから特定の投稿の詳細情報を取得します。

- **入力**:
  - `post_id` (必須): 取得する投稿のID
- **出力**: 投稿の詳細情報（ID、タイトル、内容、ステータス、メタデータなど）。

### `get_site_settings`
WordPressサイトの設定情報を取得します。

- **入力**: なし
- **出力**: サイト設定（タイトル、説明、URL、その他の一般的な設定）。

### `get_site_users`
WordPressサイトのユーザー一覧を取得します。

- **入力**:
  - `per_page` (オプション): 1ページあたりのユーザー数（デフォルト: 10、最大: 100）
  - `page` (オプション): ページ番号（デフォルト: 1）
  - `search` (オプション): 名前、メールアドレス、ユーザー名でユーザーを検索するクエリ
  - `roles` (オプション): ロールでフィルタリング（例: "administrator", "editor", "author"）。複数のロールはカンマ区切りで指定可能
- **出力**: ID、名前、メールアドレス、ロールを含むユーザーの配列。

### `update_user`
既存のWordPressユーザーを更新します。

- **入力**:
  - `id` (必須): 更新するユーザーID
  - `name` (オプション): ユーザーの新しい表示名
  - `email` (オプション): ユーザーの新しいメールアドレス
  - `description` (オプション): ユーザーの新しい説明/自己紹介
  - `url` (オプション): ユーザーの新しいウェブサイトURL
  - `roles` (オプション): ユーザーの新しいロール。単一のロールまたはカンマ区切りのロール（例: "administrator", "editor,author"）
- **出力**: 更新されたユーザーの情報（ID、名前、メールアドレス、ロールなど）。

### `get_comments`
WordPressサイトのコメント一覧を取得します。

- **入力**:
  - `per_page` (オプション): 1ページあたりのコメント数（デフォルト: 10、最大: 100）
  - `page` (オプション): ページ番号（デフォルト: 1）
  - `search` (オプション): コメント内容でコメントを検索するクエリ
  - `post_id` (オプション): 投稿IDでコメントをフィルタリング
  - `status` (オプション): ステータスでフィルタリング（approved, hold, spam, trash）
- **出力**: ID、内容、投稿ID、ステータスを含むコメントの配列。

### `get_plugins`
WordPressサイトにインストールされているプラグインの情報を取得します。

- **入力**: なし
- **出力**: インストールされているプラグインの情報（名前、バージョン、ステータスなど）。

### `get_site_statistics`
WordPressサイトの統計情報を取得します。

- **入力**: なし
- **出力**: サイト統計情報（訪問者データやパフォーマンス指標など）。
- **注意**: この機能はWordPress.com専用のAPIが必要な可能性があります。標準のWordPressインストールでは利用できない場合があります。

### `get_categories`
WordPressサイトからカテゴリー一覧を取得します。

- **入力**:
  - `per_page` (オプション): 1ページあたりのカテゴリー数（デフォルト: 10、最大: 100）
  - `page` (オプション): ページ番号（デフォルト: 1）
  - `search` (オプション): 名前でカテゴリーを検索するクエリ
- **出力**: ID、名前、説明、スラッグを含むカテゴリーの配列。

### `create_category`
WordPressに新しいカテゴリーを作成します。

- **入力**:
  - `name` (必須): カテゴリー名
  - `description` (オプション): カテゴリーの説明
  - `slug` (オプション): カテゴリーのスラッグ（URLに適した名前）
  - `parent` (オプション): 親カテゴリーID（サブカテゴリーを作成する場合）
- **出力**: 作成されたカテゴリーの情報（ID、名前、スラッグ、説明など）。

### `update_category`
既存のWordPressカテゴリーを更新します。

- **入力**:
  - `id` (必須): 更新するカテゴリーID
  - `name` (オプション): 新しいカテゴリー名
  - `description` (オプション): 新しいカテゴリーの説明
  - `slug` (オプション): 新しいカテゴリーのスラッグ
  - `parent` (オプション): 新しい親カテゴリーID（0を指定すると親子関係を削除）
- **出力**: 更新されたカテゴリーの情報。

### `delete_category`
WordPressカテゴリーを削除します。

- **入力**:
  - `id` (必須): 削除するカテゴリーID
  - `force` (オプション): trueの場合、完全削除。false（デフォルト）の場合、ゴミ箱に移動。
- **出力**: カテゴリーIDと削除ステータスを含む削除結果。

### `get_tags`
WordPressサイトからタグ一覧を取得します。

- **入力**:
  - `per_page` (オプション): 1ページあたりのタグ数（デフォルト: 10、最大: 100）
  - `page` (オプション): ページ番号（デフォルト: 1）
  - `search` (オプション): 名前でタグを検索するクエリ
- **出力**: ID、名前、説明、スラッグを含むタグの配列。

### `create_tag`
WordPressに新しいタグを作成します。

- **入力**:
  - `name` (必須): タグ名
  - `description` (オプション): タグの説明
  - `slug` (オプション): タグのスラッグ（URLに適した名前）
- **出力**: 作成されたタグの情報（ID、名前、スラッグ、説明など）。

### `update_tag`
既存のWordPressタグを更新します。

- **入力**:
  - `id` (必須): 更新するタグID
  - `name` (オプション): 新しいタグ名
  - `description` (オプション): 新しいタグの説明
  - `slug` (オプション): 新しいタグのスラッグ
- **出力**: 更新されたタグの情報。

### `delete_tag`
WordPressタグを削除します。

- **入力**:
  - `id` (必須): 削除するタグID
  - `force` (オプション): trueの場合、完全削除。false（デフォルト）の場合、ゴミ箱に移動。
- **出力**: タグIDと削除ステータスを含む削除結果。

### `create_comment`
WordPress投稿に新しいコメントを作成します。

- **入力**:
  - `post_id` (必須): コメントを投稿する投稿のID
  - `content` (必須): コメント内容
  - `author_name` (オプション): コメント投稿者名
  - `author_email` (オプション): コメント投稿者のメールアドレス
  - `parent` (オプション): 親コメントID（返信コメントを作成する場合）
- **出力**: 作成されたコメントの情報（ID、投稿ID、内容、ステータスなど）。

### `update_comment`
既存のWordPressコメントを更新します。

- **入力**:
  - `id` (必須): 更新するコメントID
  - `content` (オプション): 新しいコメント内容
  - `status` (オプション): 新しいコメントステータス（approved, hold, spam, trash）
- **出力**: 更新されたコメントの情報。

### `delete_comment`
WordPressコメントを削除します。

- **入力**:
  - `id` (必須): 削除するコメントID
  - `force` (オプション): trueの場合、完全削除。false（デフォルト）の場合、ゴミ箱に移動。
- **出力**: コメントIDと削除ステータスを含む削除結果。

## 要件

- WordPress 5.6以上（Application Passwordsサポートのため）
- WordPress REST APIが有効（WordPress 4.7以降ではデフォルトで有効）
- 適切な権限を持つユーザーアカウント（編集者または管理者を推奨）

## セキュリティ考慮事項

1. **HTTPS**: 認証情報を保護するため、WordPressサイトURLには常にHTTPSを使用してください。
2. **アプリケーションパスワード**: メインのWordPressパスワードの代わりにアプリケーションパスワードを使用してください。
3. **権限**: WordPressユーザーアカウントには必要な権限のみを付与してください。
4. **レート制限**: プラグインにはレート制限されたリクエスト用の自動リトライロジックが含まれています。

## ライセンス

MIT License — 全文は`LICENSE`を参照してください。
